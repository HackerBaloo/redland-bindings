#!/usr/bin/perl
#
# $Id$
#
# Format XHTML generated by rdoc (via tidy) for websites
#
# Usage: rdoc ....  
#        for f in `find outdir -name \*.html -print`; 
#           tidy ... $f | fix-rdoc-xhtml $f.new && mv $f.new $f;
#        donek OUTPUT-FILE
#
# Copyright (C) 2001-2005 David Beckett - http://purl.org/net/dajobe/
# Institute for Learning and Research Technology - http://www.ilrt.bris.ac.uk/
# University of Bristol - http://www.bristol.ac.uk/
#

use strict;
use File::Basename;

my $progname=basename $0;

my $main_title="Redland RDF Application Framework - Ruby RDoc";

die "USAGE: $progname OUTPUT-FILE\n" if @ARGV < 1;

my($file)=@ARGV;

open(OUT, ">$file") or die "$progname: Cannot create $file - $!\n";
open(IN, "-");
while(<IN>) {

  if(m%<title>(.*?)</title>%) {
    s%<title>(.*?)</title>%<title>$main_title - $1</title>%;
  }

  next if /^<meta/i;

  if(m%<link%) {
#    $_=qq{<link rel="stylesheet" href="/docs/rdoc/rdoc-style.css" type="text/css" media="screen" />\n};
  }

  if(m%"validator-badges"%) {
    while(<IN>) {
      last if m%</div>%;
    }
    next;
  }

  my $year=1900+(localtime)[5];
  print OUT <<"EOT" if m%^</body>%;
<hr />

<p>Copyright 2004-$year <a href="http://purl.org/net/dajobe/">Dave Beckett</a>, <a href="http://www.ilrt.bris.ac.uk/">Institute for Learning and Research Technology</a>, <a href="http://www.bristol.ac.uk/">University of Bristol</a></p>

EOT
  print OUT;
}
close(IN);
close(OUT);
